/*
 * ion-autocomplete 0.2.1
 * Copyright 2015 Danny Povolotski 
 * Copyright modifications 2015 Guy Brand 
 * https://github.com/guylabs/ion-autocomplete
 */
!function(){"use strict";angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicTemplateLoader","$ionicBackdrop","$rootScope","$document","$q","$parse","$ionicPlatform",function(a,b,c,d,e,f,g){return{require:"?ngModel",restrict:"A",scope:{placeholder:"@",cancelLabel:"@",selectItemsLabel:"@",selectedItemsLabel:"@",templateUrl:"@",itemsMethod:"&",itemsMethodValueKey:"@",itemValueKey:"@",itemViewValueKey:"@",multipleSelect:"@",itemsClickedMethod:"&"},link:function(c,h,i,j){if(j){c.placeholder=c.placeholder?c.placeholder:"Click to enter a value...",c.cancelLabel=c.cancelLabel?c.cancelLabel:"true"===c.multipleSelect?"Done":"Cancel",c.selectItemsLabel=c.selectItemsLabel?c.selectItemsLabel:"Select an item...",c.selectedItemsLabel=c.selectedItemsLabel?c.selectedItemsLabel:"Selected items:",c.templateUrl=c.templateUrl?c.templateUrl:"",c.items=[],c.selectedItems=[],c.searchQuery="",c.getItemValue=function(a,b){if(angular.isArray(a)){var c=[];return angular.forEach(a,function(d){c.push(b&&angular.isObject(a)?f(b)(d):d)}),c}return b&&angular.isObject(a)?f(b)(a):a};var k=['<div class="ion-autocomplete-container modal">','<div class="bar bar-header item-input-inset">','<label class="item-input-wrapper">','<i class="icon ion-ios7-search placeholder-icon"></i>','<input type="search" class="ion-autocomplete-search" ng-model="searchQuery" placeholder="{{placeholder}}"/>',"</label>",'<button class="ion-autocomplete-cancel button button-clear">{{cancelLabel}}</button>',"</div>",'<ion-content class="has-header has-header">',"<ion-list>",'<ion-item class="item-divider" ng-show="selectedItems.length > 0">{{selectedItemsLabel}}</ion-item>','<ion-item ng-repeat="selectedItem in selectedItems" type="item-text-wrap" class="item-icon-left item-icon-right">','<i class="icon ion-checkmark"></i>',"{{getItemValue(selectedItem, itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="removeItem($index)"></i>',"</ion-item>",'<ion-item class="item-divider" ng-show="items.length > 0">{{selectItemsLabel}}</ion-item>','<ion-item collection-repeat="item in items" item-height="55" item-width="100%" type="item-text-wrap" ng-click="selectItem(item)">',"{{getItemValue(item, itemViewValueKey)}}","</ion-item>","</ion-list>","</ion-content>","</div>"].join("");a.compile({templateUrl:c.templateUrl,template:k,scope:c,appendTo:d[0].body}).then(function(a){var d=angular.element(a.element.find("input"));a.scope.selectItem=function(b){a.scope.items=[],a.scope.searchQuery="","true"===a.scope.multipleSelect?(o(a.scope.selectedItems,a.scope.itemValueKey,c.getItemValue(b,c.itemValueKey))||(a.scope.selectedItems=a.scope.selectedItems.concat([b])),j.$setViewValue(a.scope.selectedItems),j.$render()):(j.$setViewValue(b),j.$render(),i()),angular.isFunction(a.scope.itemsClickedMethod)&&a.scope.itemsClickedMethod({callback:{item:b,selectedItems:a.scope.selectedItems.slice()}})},a.scope.removeItem=function(b){a.scope.selectedItems.splice(b,1),a.scope.selectedItems=a.scope.selectedItems.slice(),j.$setViewValue(a.scope.selectedItems),j.$render()},a.scope.$watch("searchQuery",function(b){if(""==b&&(a.scope.items=[]),b&&angular.isFunction(a.scope.itemsMethod)){var c=e.when(a.scope.itemsMethod({query:b}));c.then(function(b){a.scope.items=a.scope.getItemValue(b,a.scope.itemsMethodValueKey)},function(a){return e.reject(a)})}});var f=function(){b.retain(),a.element.css("display","block"),c.$deregisterBackButton=g.registerBackButtonAction(function(){i()},300)},i=function(){a.element.css("display","none"),b.release(),c.$deregisterBackButton&&c.$deregisterBackButton()},k={moved:!1,startX:0,startY:0},l=function(a){k.moved=!1,k.startX=a.touches[0].clientX,k.startY=a.touches[0].clientY},m=function(a){(Math.abs(a.touches[0].clientX-k.startX)>10||Math.abs(a.touches[0].clientY-k.startY)>10)&&(k.moved=!0)},n=function(a){k.moved||(a.preventDefault(),a.stopPropagation(),f(),d.length>0&&(d[0].focus(),setTimeout(function(){d[0].focus()},0)))},o=function(a,b,d){for(var e=0;e<a.length;e++)if(c.getItemValue(a[e],b)===d)return!0;return!1};h.bind("touchstart",l),h.bind("touchmove",m),h.bind("touchend",n),h.bind("click",n),a.element.find("button").bind("click",function(){a.scope.searchQuery="",i()})}),j.$render=function(){h.val(c.getItemValue(j.$viewValue,c.itemViewValueKey))},j.$formatters.push(function(a){return c.getItemValue(a,c.itemViewValueKey)}),j.$parsers.push(function(a){return c.getItemValue(a,c.itemValueKey)})}}}}]).directive("ionAutocomplete",function(){return{require:"?ngModel",restrict:"E",template:'<input ion-autocomplete type="text" readonly="readonly" class="ion-autocomplete" autocomplete="off" />',replace:!0}})}();